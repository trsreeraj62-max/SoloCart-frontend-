<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Checkout</title>

    <!-- Tailwind CSS (OK for static demo / Netlify) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- FontAwesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
  </head>

  <body class="bg-[#f1f3f6] min-h-screen">
    <div class="max-w-5xl mx-auto py-8 px-4">
      <!-- STEP INDICATOR -->
      <div class="flex items-center justify-center mb-8 gap-6">
        <div class="flex items-center gap-2">
          <span
            class="w-8 h-8 rounded-full bg-green-500 text-white flex items-center justify-center"
          >
            <i class="fas fa-check text-xs"></i>
          </span>
          <span class="text-xs font-bold text-gray-400 uppercase">Summary</span>
        </div>

        <div class="w-12 h-[2px] bg-green-200"></div>

        <div class="flex items-center gap-2">
          <span
            class="w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center font-bold"
            >2</span
          >
          <span class="text-xs font-bold text-gray-800 uppercase">Payment</span>
        </div>

        <div class="w-12 h-[2px] bg-gray-200"></div>

        <div class="flex items-center gap-2 opacity-40">
          <span
            class="w-8 h-8 rounded-full bg-gray-300 text-white flex items-center justify-center font-bold"
            >3</span
          >
          <span class="text-xs font-bold text-gray-400 uppercase">Finish</span>
        </div>
      </div>

      <!-- MAIN GRID -->
      <div class="grid md:grid-cols-3 gap-6">
        <!-- LEFT -->
        <div class="md:col-span-2">
          <div class="bg-white border shadow-sm p-6 text-center">
            <h2
              class="text-lg font-black mb-3 uppercase tracking-widest text-gray-700"
            >
              Total Payable Amount
            </h2>

            <div id="payment-total" class="text-4xl font-black text-[#2874f0]">
              ₹0
            </div>

            <p class="text-xs text-gray-400 mt-2">
              Inclusive of all taxes & charges
            </p>
          </div>
        </div>

        <!-- RIGHT -->
        <div class="bg-white border shadow-sm p-6 h-fit">
          <h3 class="text-lg font-black mb-4">Payment Options</h3>

          <label
            class="flex items-center gap-3 p-3 border rounded mb-3 cursor-pointer hover:bg-gray-50"
          >
            <input type="radio" name="payment_method" value="upi" checked />
            <span class="font-bold">UPI (PhonePe / GPay)</span>
          </label>

          <label
            class="flex items-center gap-3 p-3 border rounded mb-6 cursor-pointer hover:bg-gray-50"
          >
            <input type="radio" name="payment_method" value="cod" />
            <span class="font-bold">Cash on Delivery</span>
          </label>

          <button
            id="pay-btn"
            class="w-full bg-[#fb641b] text-white py-4 font-black tracking-wider hover:bg-[#ff4500] transition disabled:opacity-50"
          >
            CONFIRM & PAY
          </button>

          <p class="text-[11px] text-gray-400 text-center mt-4">
            <i class="fas fa-lock mr-1"></i> Secure Payment
          </p>
        </div>
      </div>
    </div>

    <!-- JS LOGIC -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        let total = 0;
        let found = false;

        // Try all possible keys for buy now and cart
        const buyNowKeys = ["buyNowItem", "buy_now_item"];
        const cartKeys = ["checkoutCart", "checkout_cart", "cart_items"];
        let buyNow = null,
          cart = null;
        for (const key of buyNowKeys) {
          try {
            const val = localStorage.getItem(key);
            if (val) {
              buyNow = JSON.parse(val);
              break;
            }
          } catch {}
        }
        for (const key of cartKeys) {
          try {
            const val = localStorage.getItem(key);
            if (val) {
              cart = JSON.parse(val);
              break;
            }
          } catch {}
        }

        if (buyNow && typeof buyNow === "object" && buyNow.price) {
          const price = Number(buyNow.price) || 0;
          const qty = Number(buyNow.quantity) || 1;
          total = price * qty;
          found = true;
        } else if (Array.isArray(cart) && cart.length > 0) {
          total = cart.reduce((sum, item) => {
            const price = Number(item.price) || 0;
            const qty = Number(item.quantity) || 1;
            return sum + price * qty;
          }, 0);
          found = true;
        }

        const totalEl = document.getElementById("payment-total");
        const payBtn = document.getElementById("pay-btn");

        if (!found || total <= 0) {
          totalEl.textContent = "₹0";
          payBtn.textContent = "NO ITEMS TO PAY";
          payBtn.disabled = true;
          // Debug info for developer
          payBtn.title =
            "No valid buy now or cart data in localStorage. Set buyNowItem or checkoutCart before visiting payment page.";
          return;
        }

        const formatted = total.toLocaleString("en-IN");
        totalEl.textContent = "₹" + formatted;
        payBtn.textContent = "CONFIRM & PAY ₹" + formatted;
        payBtn.disabled = false;
        payBtn.title = "";

        payBtn.addEventListener("click", function () {
          // Simulate order success and redirect to payment-success page
          window.location.href = "/payment-success.html";
        });
      });
    </script>
  </body>
</html>
